<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<span id="접속"></span>
<ul id="메세지들"></ul>
<script>
    var ws = null;
    var stomClient = null;
    var subscription = null;
    var id = null;
    var pass = null;
    ''
    $(document).ready(function () {
        var callback = function (메세지) {
            // 서버로 부터 한 STOMP 메세지 받으먼 호출됨
            if (메세지.body) {
                $("#메세지들").append($("<li>" + 메세지.body + "</li>"));
            } else {
                alert("빈 메세지");
            }
        }
        var connectCallback = function () {
            //subscription = client.subscribe("/amq/queue/uid1", callback);//큐명을 지정한경우 시 사용
            subscription = stomClient.subscribe("/topic/chatRoom.1", callback);//exchanger를 지정한경우시 사용
            //참고 RabbitMQ STOMP Adapter>Destinations -https://www.rabbitmq.com/stomp.html
            alert("subscribe 성공");
            stompClient.send("/app/chat.send.message.1", {}, JSON.stringify({
                content: '안녕',
                senderId: 1
            }))
        };
        var errorCallback = function (error) {
            //alert(error.headers.message);
        };
//ws = new WebSocket('ws://18.190.79.25:15674/ws-stomp');
        ws = new SockJS('http://127.0.0.1:15674/ws-stomp');
//ws = new SockJS('http://18.190.79.25:15674/ws-stomp');
        stompClient = Stomp.over(ws);
        stompClient.connect({}, connectCallback);
//stompClient.connect(id, pass, connectCallback, errorCallback,'/');
    });
</script>
</body>
</html>
